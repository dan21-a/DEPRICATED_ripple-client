{"filter":false,"title":"declare_tax.js","tooltip":"/src/js/services/declare_tax.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":58},"end":{"row":9,"column":59}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":57},"end":{"row":9,"column":58}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":88},"end":{"row":9,"column":93}},"text":"$http"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":87},"end":{"row":9,"column":88}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":86},"end":{"row":9,"column":87}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":123,"column":30},"end":{"row":123,"column":51}},"text":"ocalhost:8000/socket/"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":123,"column":29},"end":{"row":123,"column":30}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":29},"end":{"row":123,"column":56}},"text":"unicorn23.koding.kd.io:3000"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":125,"column":0},"end":{"row":125,"column":2}},"text":"  "},{"action":"removeLines","range":{"start":{"row":124,"column":0},"end":{"row":125,"column":0}},"nl":"\n","lines":["  $http.post('http://unicorn23.koding.kd.io:3000', TAX_BLOB).success(successCallback);"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":0},"end":{"row":124,"column":25}},"text":"ws.onopen = function(){  "},{"action":"insertText","range":{"start":{"row":124,"column":25},"end":{"row":125,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":125,"column":0},"end":{"row":126,"column":0}},"lines":["        console.log(\"Socket has been opened!\");  "]},{"action":"insertText","range":{"start":{"row":126,"column":0},"end":{"row":126,"column":6}},"text":"    };"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":26},"end":{"row":123,"column":27}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":127,"column":0},"end":{"row":128,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":0},"end":{"row":128,"column":1}},"text":"f"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":1},"end":{"row":128,"column":2}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":2},"end":{"row":128,"column":3}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":3},"end":{"row":128,"column":4}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":4},"end":{"row":128,"column":5}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":5},"end":{"row":128,"column":6}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":6},"end":{"row":128,"column":7}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":7},"end":{"row":128,"column":8}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":8},"end":{"row":128,"column":9}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":9},"end":{"row":128,"column":10}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":10},"end":{"row":128,"column":11}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":11},"end":{"row":128,"column":12}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":12},"end":{"row":128,"column":13}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":13},"end":{"row":128,"column":14}},"text":"T"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":14},"end":{"row":128,"column":15}},"text":"A"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":15},"end":{"row":128,"column":16}},"text":"X"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":16},"end":{"row":128,"column":17}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":17},"end":{"row":128,"column":18}},"text":"B"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":18},"end":{"row":128,"column":19}},"text":"L"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":19},"end":{"row":128,"column":20}},"text":"O"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":20},"end":{"row":128,"column":21}},"text":"B"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":21},"end":{"row":128,"column":22}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":128,"column":21},"end":{"row":128,"column":22}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":21},"end":{"row":128,"column":22}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":128,"column":21},"end":{"row":128,"column":22}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":21},"end":{"row":128,"column":23}},"text":"()"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":23},"end":{"row":128,"column":24}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":24},"end":{"row":128,"column":25}},"text":"{"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":128,"column":25},"end":{"row":129,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":129,"column":0},"end":{"row":130,"column":0}},"lines":["    "]},{"action":"insertText","range":{"start":{"row":130,"column":0},"end":{"row":130,"column":1}},"text":"}"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":129,"column":4},"end":{"row":130,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":130,"column":0},"end":{"row":130,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":4},"end":{"row":130,"column":38}},"text":" ws.send(JSON.stringify(request));"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":130,"column":28},"end":{"row":130,"column":35}},"text":"request"},{"action":"insertText","range":{"start":{"row":130,"column":28},"end":{"row":130,"column":29}},"text":"T"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":29},"end":{"row":130,"column":30}},"text":"A"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":30},"end":{"row":130,"column":31}},"text":"X"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":130,"column":28},"end":{"row":130,"column":31}},"text":"TAX"},{"action":"insertText","range":{"start":{"row":130,"column":28},"end":{"row":130,"column":36}},"text":"TAX_BLOB"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":1},"end":{"row":132,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":132,"column":0},"end":{"row":133,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":0},"end":{"row":133,"column":1}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":1},"end":{"row":133,"column":2}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":2},"end":{"row":133,"column":3}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":3},"end":{"row":133,"column":4}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":0},"end":{"row":133,"column":4}},"text":"send"},{"action":"insertText","range":{"start":{"row":133,"column":0},"end":{"row":133,"column":14}},"text":"sendTAX_BLOB()"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":133,"column":14},"end":{"row":133,"column":15}},"text":";"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":133,"column":0},"end":{"row":133,"column":15}},"text":"sendTAX_BLOB();"},{"action":"removeLines","range":{"start":{"row":128,"column":0},"end":{"row":133,"column":0}},"nl":"\n","lines":["function sendTAX_BLOB() {","    ","     ws.send(JSON.stringify(TAX_BLOB));","}",""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":125,"column":49},"end":{"row":126,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":126,"column":0},"end":{"row":126,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":126,"column":8},"end":{"row":127,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":127,"column":0},"end":{"row":127,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":127,"column":8},"end":{"row":128,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":128,"column":0},"end":{"row":128,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":126,"column":8},"end":{"row":126,"column":33}},"text":"function sendTAX_BLOB() {"},{"action":"insertText","range":{"start":{"row":126,"column":33},"end":{"row":127,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":127,"column":0},"end":{"row":131,"column":0}},"lines":["    ","     ws.send(JSON.stringify(TAX_BLOB));","}",""]},{"action":"insertText","range":{"start":{"row":131,"column":0},"end":{"row":131,"column":15}},"text":"sendTAX_BLOB();"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":127,"column":0},"end":{"row":127,"column":4}},"text":"    "},{"action":"removeLines","range":{"start":{"row":126,"column":0},"end":{"row":127,"column":0}},"nl":"\n","lines":["        function sendTAX_BLOB() {"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":128,"column":0},"end":{"row":128,"column":1}},"text":"}"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":131,"column":0},"end":{"row":131,"column":8}},"text":"        "},{"action":"removeLines","range":{"start":{"row":130,"column":0},"end":{"row":131,"column":0}},"nl":"\n","lines":["sendTAX_BLOB();"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":129,"column":0},"end":{"row":130,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":128,"column":0},"end":{"row":129,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":122,"column":32},"end":{"row":123,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":123,"column":0},"end":{"row":123,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":4},"end":{"row":124,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":124,"column":0},"end":{"row":124,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":0},"end":{"row":124,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":123,"column":4},"end":{"row":124,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":4},"end":{"row":123,"column":5}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":5},"end":{"row":123,"column":6}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":6},"end":{"row":123,"column":62}},"text":"http://clintberry.com/2013/angular-js-websocket-service/"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":39},"end":{"row":124,"column":56}},"text":".koding.kd.io:300"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":38},"end":{"row":124,"column":39}},"text":"3"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":37},"end":{"row":124,"column":38}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":36},"end":{"row":124,"column":37}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":35},"end":{"row":124,"column":36}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":34},"end":{"row":124,"column":35}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":33},"end":{"row":124,"column":34}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":32},"end":{"row":124,"column":33}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":31},"end":{"row":124,"column":32}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":31},"end":{"row":124,"column":32}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":124,"column":30},"end":{"row":124,"column":31}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":30},"end":{"row":124,"column":56}},"text":"server-22599.onmodulus.net"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":56},"end":{"row":124,"column":57}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":57},"end":{"row":124,"column":58}},"text":"8"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":58},"end":{"row":124,"column":59}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":59},"end":{"row":124,"column":60}},"text":"8"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":124,"column":60},"end":{"row":124,"column":61}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":128,"column":39},"end":{"row":129,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":6},"end":{"row":131,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":131,"column":0},"end":{"row":131,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":4},"end":{"row":132,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":132,"column":0},"end":{"row":132,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":132,"column":4},"end":{"row":132,"column":21}},"text":"var Service = {};"},{"action":"insertText","range":{"start":{"row":132,"column":21},"end":{"row":133,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":133,"column":0},"end":{"row":191,"column":0}},"lines":["    // Keep all pending requests here until they get responses","    var callbacks = {};","    // Create a unique callback ID to map requests to responses","    var currentCallbackId = 0;","    // Create our websocket object with the address to the websocket","    var ws = new WebSocket(\"ws://localhost:8000/socket/\");","    ","    ws.onopen = function(){  ","        console.log(\"Socket has been opened!\");  ","    };","    ","    ws.onmessage = function(message) {","        listener(JSON.parse(message.data));","    };","","    function sendRequest(request) {","      var defer = $q.defer();","      var callbackId = getCallbackId();","      callbacks[callbackId] = {","        time: new Date(),","        cb:defer","      };","      request.callback_id = callbackId;","      console.log('Sending request', request);","      ws.send(JSON.stringify(request));","      return defer.promise;","    }","","    function listener(data) {","      var messageObj = data;","      console.log(\"Received data from websocket: \", messageObj);","      // If an object exists with callback_id in our callbacks object, resolve it","      if(callbacks.hasOwnProperty(messageObj.callback_id)) {","        console.log(callbacks[messageObj.callback_id]);","        $rootScope.$apply(callbacks[messageObj.callback_id].cb.resolve(messageObj.data));","        delete callbacks[messageObj.callbackID];","      }","    }","    // This creates a new callback ID for a request","    function getCallbackId() {","      currentCallbackId += 1;","      if(currentCallbackId > 10000) {","        currentCallbackId = 0;","      }","      return currentCallbackId;","    }","","    // Define a \"getter\" for getting customer data","    Service.getCustomers = function() {","      var request = {","        type: \"get_customers\"","      }","      // Storing in a variable for clarity on what sendRequest returns","      var promise = sendRequest(request); ","      return promise;","    }","","    return Service;"]},{"action":"insertText","range":{"start":{"row":191,"column":0},"end":{"row":191,"column":3}},"text":"}])"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":191,"column":2},"end":{"row":191,"column":3}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":191,"column":1},"end":{"row":191,"column":2}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":191,"column":0},"end":{"row":191,"column":1}},"text":"}"},{"action":"removeLines","range":{"start":{"row":133,"column":0},"end":{"row":191,"column":0}},"nl":"\n","lines":["    // Keep all pending requests here until they get responses","    var callbacks = {};","    // Create a unique callback ID to map requests to responses","    var currentCallbackId = 0;","    // Create our websocket object with the address to the websocket","    var ws = new WebSocket(\"ws://localhost:8000/socket/\");","    ","    ws.onopen = function(){  ","        console.log(\"Socket has been opened!\");  ","    };","    ","    ws.onmessage = function(message) {","        listener(JSON.parse(message.data));","    };","","    function sendRequest(request) {","      var defer = $q.defer();","      var callbackId = getCallbackId();","      callbacks[callbackId] = {","        time: new Date(),","        cb:defer","      };","      request.callback_id = callbackId;","      console.log('Sending request', request);","      ws.send(JSON.stringify(request));","      return defer.promise;","    }","","    function listener(data) {","      var messageObj = data;","      console.log(\"Received data from websocket: \", messageObj);","      // If an object exists with callback_id in our callbacks object, resolve it","      if(callbacks.hasOwnProperty(messageObj.callback_id)) {","        console.log(callbacks[messageObj.callback_id]);","        $rootScope.$apply(callbacks[messageObj.callback_id].cb.resolve(messageObj.data));","        delete callbacks[messageObj.callbackID];","      }","    }","    // This creates a new callback ID for a request","    function getCallbackId() {","      currentCallbackId += 1;","      if(currentCallbackId > 10000) {","        currentCallbackId = 0;","      }","      return currentCallbackId;","    }","","    // Define a \"getter\" for getting customer data","    Service.getCustomers = function() {","      var request = {","        type: \"get_customers\"","      }","      // Storing in a variable for clarity on what sendRequest returns","      var promise = sendRequest(request); ","      return promise;","    }","","    return Service;"]},{"action":"removeText","range":{"start":{"row":132,"column":1},"end":{"row":132,"column":21}},"text":"   var Service = {};"},{"action":"removeText","range":{"start":{"row":132,"column":1},"end":{"row":133,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":132,"column":0},"end":{"row":132,"column":1}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":131,"column":4},"end":{"row":132,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":131,"column":0},"end":{"row":131,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":130,"column":6},"end":{"row":131,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":129,"column":0},"end":{"row":130,"column":0}},"text":"\n"}]}]]},"ace":{"folds":[],"scrolltop":1650.5,"scrollleft":0,"selection":{"start":{"row":131,"column":6},"end":{"row":131,"column":6},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1411334416000,"hash":"b3d9745f32469edd5c85f6b881ffb293ea6bfca9"}